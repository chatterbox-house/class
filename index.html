<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEWS to ME</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* Newspaper-inspired base styles */
    :root {
      --headline-font: 'Playfair Display', serif;
      --body-font: 'Roboto Condensed', sans-serif;
      --dark-bg: #1a1a1a;
      --dark-text: #f0f0f0;
      --light-bg: #f5f5f5;
      --light-text: #222;
      --accent-red: #c00;
      --accent-blue: #0066cc;
      --paper-texture: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="1" stitchTiles="stitch"/><feColorMatrix type="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.05 0"/></filter><rect width="100%" height="100%" filter="url(%23noise)" opacity="0.3"/></svg>');
      
      /* Font size variables */
      --base-font-size: 2.5rem;
      --headline-font-size: 2.75rem;
      --article-font-size: 2.5rem;
      --min-font-size: 1.5rem;
      --max-font-size: 5rem;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: var(--body-font);
      background-color: var(--dark-bg);
      color: var(--dark-text);
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      background-image: var(--paper-texture);
      transition: all 0.3s ease;
    }
    
    body.light-mode {
      background-color: var(--light-bg);
      color: var(--light-text);
    }
    
    /* Masthead styling */
    header {
      height: 6vh;
      background: linear-gradient(to right, #222, #444);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 2rem;
      border-bottom: 4px double #666;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      position: relative;
      z-index: 2;
    }
    
    body.light-mode header {
      background: linear-gradient(to right, #ddd, #f0f0f0);
      border-bottom: 4px double #aaa;
    }
    
    .masthead {
      font-family: var(--headline-font);
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
    }
    
    body.light-mode .masthead {
      color: #222;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    }
    
    .header-info {
      display: flex;
      gap: 2rem;
      font-size: 1.2rem;
      font-weight: 700;
    }
    
    .header-controls {
      display: flex;
      gap: 1rem;
    }
    
    /* Newspaper column styling */
    .content-container {
      display: flex;
      flex-direction: column;
      height: 88vh;
      padding: 1rem;
      gap: 1rem;
    }
    
    .news-container {
      flex: 1;
      border: 1px solid #444;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      position: relative;
      background: rgba(30, 30, 30, 0.8);
      box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
      transition: all 0.3s ease;
      border-radius: 0;
    }
    
    body.light-mode .news-container {
      background: rgba(250, 250, 250, 0.9);
      border: 1px solid #aaa;
    }
    
    .news-content {
      width: 90%;
      max-height: 100%;
      overflow: hidden;
      text-align: center;
      transition: font-size 0.3s ease;
      position: relative;
      font-size: var(--base-font-size);
    }
    
    .headline {
      font-family: var(--headline-font);
      font-weight: 700;
      line-height: 1.3;
      margin-bottom: 0.5rem;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
      font-size: var(--headline-font-size);
    }
    
    body.light-mode .headline {
      text-shadow: none;
    }
    
    .pub-date {
      font-size: 0.7em;
      opacity: 0.8;
      font-style: italic;
      margin-top: 0.3rem;
    }
    
    .breaking-badge {
      display: inline-block;
      background: var(--accent-red);
      color: white;
      font-size: 0.6em;
      padding: 0.2em 0.5em;
      border-radius: 3px;
      margin-left: 0.5em;
      vertical-align: middle;
      text-transform: uppercase;
      font-weight: bold;
    }
    
    /* Footer controls */
    footer {
      height: 6vh;
      background: linear-gradient(to right, #222, #444);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 2rem;
      border-top: 4px double #666;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
    }
    
    body.light-mode footer {
      background: linear-gradient(to right, #ddd, #f0f0f0);
      border-top: 4px double #aaa;
    }
    
    .footer-center {
      flex: 1;
      display: flex;
      justify-content: center;
    }
    
    .classroom-link {
      display: inline-block;
      background-color: #ff5722;
      color: white;
      font-weight: bold;
      padding: 0.5rem 1.5rem;
      border-radius: 30px;
      text-decoration: none;
      text-transform: uppercase;
      font-size: 1.2rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      margin: 0 1rem;
    }
    
    .classroom-link:hover {
      background-color: #ff7043;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.4);
    }
    
    .classroom-link:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    body.light-mode .classroom-link {
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .footer-controls {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    
    /* Button styles */
    button {
      min-width: 60px;
      min-height: 40px;
      background: #333;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      font-family: var(--body-font);
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    body.light-mode button {
      background: #555;
    }
    
    button:focus-visible {
      outline: 3px solid var(--accent-blue);
      background: #555;
    }
    
    button:hover {
      background: #444;
      transform: translateY(-1px);
      box-shadow: 0 3px 7px rgba(0,0,0,0.3);
    }
    
    body.light-mode button:hover {
      background: #666;
    }
    
    button.active {
      background: var(--accent-blue);
    }
    
    .nav-btn {
      font-weight: bold;
      font-size: 1.2rem;
    }
    
    /* Modal styles - Updated for full-screen dynamic fitting */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 100;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    
    body.light-mode .modal {
      background: rgba(0, 0, 0, 0.85);
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-container {
      width: 100%;
      height: 100%;
      border: none;
      margin: 0;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      background: var(--dark-bg);
      background-image: var(--paper-texture);
    }
    
    body.light-mode .modal-container {
      background: var(--light-bg);
      color: var(--light-text);
    }
    
    /* Article view - Updated to match headline style */
    .article-view {
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      overflow: hidden;
    }
    
    .article-sentence-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 1rem;
      overflow: hidden;
      width: 100%;
    }
    
    .article-sentence {
      width: 90%;
      text-align: center;
      margin-bottom: 1rem;
      padding: 1rem;
      line-height: 1.5;
      overflow: auto;
      max-height: 40vh;
      font-size: var(--article-font-size);
    }
    
    .article-translation {
      width: 90%;
      text-align: center;
      color: #aaa;
      font-style: italic;
      padding: 1rem;
      border-top: 1px solid #444;
      line-height: 1.5;
      overflow: auto;
      max-height: 40vh;
      font-size: var(--article-font-size);
    }
    
    body.light-mode .article-translation {
      color: #666;
      border-top: 1px solid #aaa;
    }
    
    .article-nav {
      display: flex;
      justify-content: space-between;
      width: 100%;
      padding: 1rem 2rem;
      background: rgba(0, 0, 0, 0.5);
      position: sticky;
      bottom: 0;
    }
    
    .article-progress {
      text-align: center;
      font-size: 0.9rem;
      opacity: 0.7;
      margin: 0.5rem 0;
    }
    
    /* Close button styling */
    .close-modal-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      z-index: 101;
      background: var(--accent-red);
    }
    
    /* Font size controls */
    .font-controls {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .font-size-display {
      min-width: 60px;
      text-align: center;
      font-weight: bold;
    }
    
    /* Modal font controls */
    .modal-font-controls {
      position: absolute;
      top: 1rem;
      left: 1rem;
      display: flex;
      gap: 0.5rem;
      align-items: center;
      z-index: 101;
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    
    /* Focus styles for remote navigation */
    [tabindex]:focus-visible {
      outline: 3px solid var(--accent-blue);
      background: #555;
    }
    
    /* Utility classes */
    .hidden {
      display: none !important;
    }
    
    .dimmed {
      opacity: 0.6;
    }
    
    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    /* TV remote friendly elements */
    button, [tabindex] {
      -webkit-tap-highlight-color: transparent;
    }
    
    button:focus {
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <!-- Newspaper Masthead -->
  <header>
    <div class="masthead">NEWS to ME</div>
    <div class="header-info">
      <div id="clock">00:00:00</div>
      <div id="date">2023-01-01</div>
      <div id="weather">Osaka: --¬∞C</div>
    </div>
    <div class="header-controls">
      <button id="pause-btn" class="nav-btn" tabindex="1">‚è∏ Pause</button>
      <button id="next-btn" class="nav-btn" tabindex="2">‚è≠ Next</button>
      <button id="source-btn" tabindex="3">BBC</button>
    </div>
  </header>

  <!-- Main Newspaper Content -->
  <div class="content-container">
    <!-- Top container (English headlines) -->
    <div class="news-container" id="english-container">
      <div class="news-content" id="english-content">
        <div class="headline">Loading headlines...</div>
      </div>
      <div class="container-controls">
        <button class="toggle-btn" data-target="english-container" tabindex="4">Hide</button>
      </div>
    </div>
    
    <!-- Bottom container (Japanese translation) -->
    <div class="news-container" id="japanese-container">
      <div class="news-content" id="japanese-content">
        <div class="headline">ÁøªË®≥„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
      </div>
      <div class="container-controls">
        <button class="toggle-btn" data-target="japanese-container" tabindex="5">Hide</button>
      </div>
    </div>
  </div>

  <!-- Newspaper Footer with Controls -->
  <footer>
    <div class="footer-info">
      <button class="mode-toggle" id="mode-toggle" tabindex="6">üåô Night Mode</button>
    </div>
    <div class="footer-center">
      <a href="classroom.html" class="classroom-link" tabindex="10">Classroom Mode</a>
    </div>
    <div class="footer-controls">
      <div class="font-controls">
        <button id="font-decrease" tabindex="7">A-</button>
        <span class="font-size-display" id="font-size-display">100%</span>
        <button id="font-increase" tabindex="8">A+</button>
      </div>
      <button id="font-reset" tabindex="9">Reset Size</button>
    </div>
  </footer>

  <!-- Article modal (hidden initially) - Updated structure -->
  <div class="modal" id="article-modal" tabindex="10">
    <div class="modal-font-controls">
      <button id="modal-font-decrease" tabindex="14">A-</button>
      <span class="font-size-display" id="modal-font-size-display">100%</span>
      <button id="modal-font-increase" tabindex="15">A+</button>
      <button id="modal-font-reset" tabindex="16">Reset</button>
    </div>
    <button id="close-modal-btn" class="close-modal-btn" tabindex="12">‚úï Close</button>
    <div class="modal-container">
      <div class="article-view" id="article-display">
        <div class="article-sentence-container">
          <div class="article-sentence" id="article-sentence"></div>
          <div class="article-translation" id="article-translation"></div>
          <div class="article-progress" id="article-progress"></div>
        </div>
        <div class="article-nav">
          <button id="prev-sentence-btn" tabindex="11">‚Üê Previous</button>
          <button id="next-sentence-btn" tabindex="13">Next ‚Üí</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // App Configuration
    const config = {
      rotationInterval: 10000, // 10 seconds
      maxHeadlines: 50,
      weatherUpdateInterval: 900000, // 15 minutes
      translationCacheTTL: 86400000, // 24 hours
      baseFontSize: 2.5, // rem
      minFontSize: 1.5, // rem
      maxFontSize: 5.0, // rem
      fontSizeStep: 0.5, // rem
// RSS Feeds - only BBC and Guardian as requested
rssFeeds: {
  'BBC': {
    url: 'http://feeds.bbci.co.uk/news/world/rss.xml',
    type: 'api'
  },
  'Guardian': {
    url: 'https://www.theguardian.com/world/rss',
    type: 'api'
  },
  'NBC': {
    url: 'https://feeds.nbcnews.com/nbcnews/public/news',
    type: 'api'
  }
},
      // MyMemory Translation API (no key required for limited use)
      translationAPI: 'https://api.mymemory.translated.net/get',
      // Fallback RSS parser API
      rssParserAPI: 'https://api.rss2json.com/v1/api.json?rss_url='
    };

    // App State
    let state = {
      currentSource: 'BBC',
      headlines: [],
      currentIndex: 0,
      isPaused: false,
      rotationTimer: null,
      weatherTimer: null,
      clockTimer: null,
      translationCache: {},
      modalState: {
        isOpen: false,
        currentArticle: null,
        currentSentenceIndex: 0,
        sentences: [],
        translations: []
      },
      darkMode: true,
      currentFontSize: config.baseFontSize,
      currentFontPercentage: 100
    };

    // DOM Elements
    const elements = {
      clock: document.getElementById('clock'),
      date: document.getElementById('date'),
      weather: document.getElementById('weather'),
      englishContent: document.getElementById('english-content'),
      japaneseContent: document.getElementById('japanese-content'),
      pauseBtn: document.getElementById('pause-btn'),
      nextBtn: document.getElementById('next-btn'),
      sourceBtn: document.getElementById('source-btn'),
      articleModal: document.getElementById('article-modal'),
      articleDisplay: document.getElementById('article-display'),
      articleSentence: document.getElementById('article-sentence'),
      articleTranslation: document.getElementById('article-translation'),
      articleProgress: document.getElementById('article-progress'),
      prevSentenceBtn: document.getElementById('prev-sentence-btn'),
      nextSentenceBtn: document.getElementById('next-sentence-btn'),
      closeModalBtn: document.getElementById('close-modal-btn'),
      toggleButtons: document.querySelectorAll('.toggle-btn'),
      modeToggle: document.getElementById('mode-toggle'),
      fontDecrease: document.getElementById('font-decrease'),
      fontReset: document.getElementById('font-reset'),
      fontIncrease: document.getElementById('font-increase'),
      fontSizeDisplay: document.getElementById('font-size-display'),
      modalFontDecrease: document.getElementById('modal-font-decrease'),
      modalFontReset: document.getElementById('modal-font-reset'),
      modalFontIncrease: document.getElementById('modal-font-increase'),
      modalFontSizeDisplay: document.getElementById('modal-font-size-display')
    };

    // Initialize the app
    function init() {
      loadSettings();
      initEventListeners();
      startClock();
      fetchWeather();
      loadHeadlines();
      updateModeToggle();
      updateSourceButton();
      updateFontSize();
    }

    // Load settings from localStorage
    function loadSettings() {
      const savedMode = localStorage.getItem('darkMode');
      if (savedMode !== null) {
        state.darkMode = savedMode === 'true';
        document.body.classList.toggle('light-mode', !state.darkMode);
      }
      
      const savedCache = localStorage.getItem('translationCache');
      if (savedCache) {
        try {
          state.translationCache = JSON.parse(savedCache);
          // Clean up expired cache entries
          const now = Date.now();
          Object.keys(state.translationCache).forEach(key => {
            if (state.translationCache[key].expiry < now) {
              delete state.translationCache[key];
            }
          });
        } catch (e) {
          console.error('Failed to parse translation cache', e);
        }
      }
      
      const savedSource = localStorage.getItem('currentSource');
      if (savedSource && config.rssFeeds[savedSource]) {
        state.currentSource = savedSource;
      }
      
      const savedFontSize = localStorage.getItem('fontSize');
      if (savedFontSize) {
        state.currentFontSize = parseFloat(savedFontSize);
        state.currentFontPercentage = Math.round((state.currentFontSize / config.baseFontSize) * 100);
      }
    }

    // Initialize event listeners
    function initEventListeners() {
      elements.pauseBtn.addEventListener('click', togglePause);
      elements.nextBtn.addEventListener('click', showNextHeadline);
      elements.sourceBtn.addEventListener('click', cycleNewsSource);
      elements.closeModalBtn.addEventListener('click', closeModal);
      elements.prevSentenceBtn.addEventListener('click', showPrevSentence);
      elements.nextSentenceBtn.addEventListener('click', showNextSentence);
      elements.modeToggle.addEventListener('click', toggleDarkMode);
      elements.fontDecrease.addEventListener('click', () => adjustFontSize(-config.fontSizeStep));
      elements.fontReset.addEventListener('click', resetFontSize);
      elements.fontIncrease.addEventListener('click', () => adjustFontSize(config.fontSizeStep));
      elements.modalFontDecrease.addEventListener('click', () => adjustFontSize(-config.fontSizeStep));
      elements.modalFontReset.addEventListener('click', resetFontSize);
      elements.modalFontIncrease.addEventListener('click', () => adjustFontSize(config.fontSizeStep));
      
      elements.toggleButtons.forEach(btn => {
        btn.addEventListener('click', function() {
          const target = document.getElementById(this.dataset.target);
          target.classList.toggle('hidden');
          this.textContent = target.classList.contains('hidden') ? 'Show' : 'Hide';
        });
      });
      
      // Make headlines clickable
      elements.englishContent.addEventListener('click', openCurrentArticle);
      elements.japaneseContent.addEventListener('click', openCurrentArticle);
      
      // Keyboard navigation for TV remote
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight') {
          if (state.modalState.isOpen) {
            showNextSentence();
          } else {
            showNextHeadline();
          }
        } else if (e.key === 'ArrowLeft') {
          if (state.modalState.isOpen) {
            showPrevSentence();
          } else {
            showPrevHeadline();
          }
        } else if (e.key === 'Enter') {
          if (!state.modalState.isOpen) {
            openCurrentArticle();
          }
        } else if (e.key === 'Escape' && state.modalState.isOpen) {
          closeModal();
        } else if (e.key === '+' || e.key === '=') {
          adjustFontSize(config.fontSizeStep);
        } else if (e.key === '-') {
          adjustFontSize(-config.fontSizeStep);
        } else if (e.key === '0') {
          resetFontSize();
        }
      });
    }

    // Font size controls
    function adjustFontSize(change) {
      const newSize = state.currentFontSize + change;
      
      state.currentFontSize = Math.max(
        config.minFontSize,
        Math.min(config.maxFontSize, newSize)
      );
      
      state.currentFontPercentage = Math.round((state.currentFontSize / config.baseFontSize) * 100);
      updateFontSize();
      localStorage.setItem('fontSize', state.currentFontSize.toString());
    }

    function resetFontSize() {
      state.currentFontSize = config.baseFontSize;
      state.currentFontPercentage = 100;
      updateFontSize();
      localStorage.setItem('fontSize', state.currentFontSize.toString());
    }

    function updateFontSize() {
      // Update CSS variables
      document.documentElement.style.setProperty('--base-font-size', `${state.currentFontSize}rem`);
      document.documentElement.style.setProperty('--headline-font-size', `${state.currentFontSize * 1.1}rem`);
      document.documentElement.style.setProperty('--article-font-size', `${state.currentFontSize}rem`);
      
      // Update the font size displays
      elements.fontSizeDisplay.textContent = `${state.currentFontPercentage}%`;
      elements.modalFontSizeDisplay.textContent = `${state.currentFontPercentage}%`;
      
      // Force redraw for Android TV browsers
      document.body.style.zoom = '1';
      setTimeout(() => {
        document.body.style.zoom = '';
      }, 10);
    }

    // Cycle through news sources
    function cycleNewsSource() {
      const sources = Object.keys(config.rssFeeds);
      const currentIndex = sources.indexOf(state.currentSource);
      const nextIndex = (currentIndex + 1) % sources.length;
      state.currentSource = sources[nextIndex];
      
      updateSourceButton();
      localStorage.setItem('currentSource', state.currentSource);
      loadHeadlines();
    }

    function updateSourceButton() {
      elements.sourceBtn.textContent = state.currentSource;
    }

    // Dark mode toggle
    function toggleDarkMode() {
      state.darkMode = !state.darkMode;
      document.body.classList.toggle('light-mode', !state.darkMode);
      localStorage.setItem('darkMode', state.darkMode);
      updateModeToggle();
    }

    function updateModeToggle() {
      elements.modeToggle.textContent = state.darkMode ? '‚òÄÔ∏è Day Mode' : 'üåô Night Mode';
    }

    // Clock functionality
    function startClock() {
      updateClock();
      state.clockTimer = setInterval(updateClock, 1000);
    }

    function updateClock() {
      const now = new Date();
      
      // Format time (JST)
      let hours = now.getHours();
      let minutes = now.getMinutes();
      let seconds = now.getSeconds();
      
      hours = hours < 10 ? '0' + hours : hours;
      minutes = minutes < 10 ? '0' + minutes : minutes;
      seconds = seconds < 10 ? '0' + seconds : seconds;
      
      elements.clock.textContent = `${hours}:${minutes}:${seconds}`;
      
      // Format date
      const year = now.getFullYear();
      const month = now.getMonth() + 1;
      const day = now.getDate();
      
      elements.date.textContent = `${year}-${month < 10 ? '0' + month : month}-${day < 10 ? '0' + day : day}`;
    }

    // Weather functionality
    function fetchWeather() {
      fetch('https://weather.tsukumijima.net/api/forecast/city/270000')
        .then(response => {
          if (!response.ok) throw new Error('Weather API error');
          return response.json();
        })
        .then(data => {
          if (data.forecasts && data.forecasts[0]) {
            const temp = data.forecasts[0].temperature.max?.celsius || '--';
            elements.weather.textContent = `Osaka: ${temp}¬∞C`;
          }
        })
        .catch(error => {
          console.error('Failed to fetch weather:', error);
          elements.weather.textContent = 'Osaka: --¬∞C';
        })
        .finally(() => {
          state.weatherTimer = setTimeout(fetchWeather, config.weatherUpdateInterval);
        });
    }

    // News functionality
    function loadHeadlines() {
      const feedConfig = config.rssFeeds[state.currentSource];
      if (!feedConfig) {
        console.error('No RSS feed config found for source:', state.currentSource);
        return;
      }
      
      // Clear existing headlines and show loading message
      state.headlines = [];
      elements.englishContent.innerHTML = '<div class="headline">Loading headlines...</div>';
      elements.japaneseContent.innerHTML = '<div class="headline">„Éò„ÉÉ„Éâ„É©„Ç§„É≥„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>';
      
      if (feedConfig.type === 'direct') {
        // Use direct parsing for problematic feeds
        fetchDirectFeed(feedConfig.directUrl || feedConfig.url);
      } else {
        // Use API for other feeds
        fetchApiFeed(feedConfig.url);
      }
    }

    function fetchApiFeed(url) {
      const proxyUrl = config.rssParserAPI + encodeURIComponent(url);
      
      fetch(proxyUrl)
        .then(response => {
          if (!response.ok) throw new Error('RSS fetch failed');
          return response.json();
        })
        .then(data => {
          if (data.items && data.items.length) {
            processHeadlines(data.items);
          } else {
            throw new Error('No headlines found');
          }
        })
        .catch(error => {
          console.error('Failed to load headlines via API:', error);
          // Try direct parsing as fallback
          fetchDirectFeed(url);
        });
    }

    function fetchDirectFeed(url) {
      fetch(url)
        .then(response => {
          if (!response.ok) throw new Error('Direct RSS fetch failed');
          return response.text();
        })
        .then(str => new window.DOMParser().parseFromString(str, "text/xml"))
        .then(data => {
          const items = data.querySelectorAll("item");
          const headlines = Array.from(items).map(item => ({
            title: item.querySelector("title")?.textContent || "No title",
            description: item.querySelector("description")?.textContent || "",
            content: item.querySelector("content\\:encoded")?.textContent || 
                     item.querySelector("description")?.textContent || "",
            link: item.querySelector("link")?.textContent || "#",
            pubDate: parsePubDate(item.querySelector("pubDate")?.textContent || "")
          }));
          
          if (headlines.length) {
            processHeadlines(headlines);
          } else {
            throw new Error('No headlines found in direct feed');
          }
        })
        .catch(error => {
          console.error('Failed to load headlines directly:', error);
          elements.englishContent.innerHTML = '<div class="headline">Failed to load headlines. Trying again...</div>';
          elements.japaneseContent.innerHTML = '<div class="headline">„Éò„ÉÉ„Éâ„É©„Ç§„É≥„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÂÜçË©¶Ë°å‰∏≠...</div>';
          setTimeout(loadHeadlines, 5000);
        });
    }
    
    function parsePubDate(dateStr) {
      if (!dateStr) return null;
      try {
        const date = new Date(dateStr);
        return isNaN(date.getTime()) ? null : date;
      } catch (e) {
        return null;
      }
    }

    function processHeadlines(items) {
      state.headlines = items.slice(0, config.maxHeadlines);
      state.currentIndex = 0;
      displayCurrentHeadline();
      startRotation();
    }

    function displayCurrentHeadline() {
      if (state.headlines.length === 0) return;
      
      const headline = state.headlines[state.currentIndex];
      const displayText = headline.title || "No title available";
      
      // Create HTML for the headline with publication date
      let englishHTML = `<div class="headline">${displayText}`;
      
      // Add breaking news badge if published in last 3 years (for demo purposes)
      if (headline.pubDate) {
        const threeYearsAgo = new Date();
        threeYearsAgo.setFullYear(threeYearsAgo.getFullYear() - 3);
        
        if (headline.pubDate > threeYearsAgo) {
          englishHTML += `<span class="breaking-badge">Breaking</span>`;
        }
        
        const formattedDate = formatDate(headline.pubDate);
        englishHTML += `<div class="pub-date">${formattedDate}</div>`;
      }
      
      englishHTML += `</div>`;
      
      elements.englishContent.innerHTML = englishHTML;
      elements.englishContent.classList.add('fade-in');
      
      // Check cache first
      const cachedTranslation = getCachedTranslation(displayText);
      if (cachedTranslation) {
        elements.japaneseContent.innerHTML = `<div class="headline">${cachedTranslation}</div>`;
        if (headline.pubDate) {
          elements.japaneseContent.innerHTML += `<div class="pub-date">${formatDate(headline.pubDate, true)}</div>`;
        }
        elements.japaneseContent.classList.add('fade-in');
      } else {
        elements.japaneseContent.innerHTML = '<div class="headline">ÁøªË®≥‰∏≠...</div>';
        translateText(displayText)
          .then(translation => {
            elements.japaneseContent.innerHTML = `<div class="headline">${translation}</div>`;
            if (headline.pubDate) {
              elements.japaneseContent.innerHTML += `<div class="pub-date">${formatDate(headline.pubDate, true)}</div>`;
            }
            elements.japaneseContent.classList.add('fade-in');
            cacheTranslation(displayText, translation);
          })
          .catch(error => {
            console.error('Translation failed:', error);
            elements.japaneseContent.innerHTML = `<div class="headline">${simpleTranslate(displayText)}</div>`;
            if (headline.pubDate) {
              elements.japaneseContent.innerHTML += `<div class="pub-date">${formatDate(headline.pubDate, true)}</div>`;
            }
            elements.japaneseContent.classList.add('dimmed');
          });
      }
      
      // Remove animation class after it completes
      setTimeout(() => {
        elements.englishContent.classList.remove('fade-in');
        elements.japaneseContent.classList.remove('fade-in');
        elements.japaneseContent.classList.remove('dimmed');
      }, 500);
    }
    
    function formatDate(date, inJapanese = false) {
      if (!date) return '';
      
      const options = {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      };
      
      if (inJapanese) {
        options.locale = 'ja-JP';
        options.timeZone = 'Asia/Tokyo';
        return date.toLocaleString('ja-JP', options);
      } else {
        return date.toLocaleString('en-US', options);
      }
    }

    // Simple fallback translation for demo purposes
    function simpleTranslate(text) {
      const mockTranslations = {
        "COVID": "„Ç≥„É≠„Éä„Ç¶„Ç§„É´„Çπ",
        "election": "ÈÅ∏Êåô",
        "news": "„Éã„É•„Éº„Çπ",
        "update": "Êõ¥Êñ∞",
        "breaking": "ÈÄüÂ†±",
        "war": "Êà¶‰∫â",
        "peace": "Âπ≥Âíå",
        "economy": "ÁµåÊ∏à",
        "market": "Â∏ÇÂ†¥",
        "report": "Â†±Âëä",
        "Japan": "Êó•Êú¨",
        "China": "‰∏≠ÂõΩ",
        "U.S.": "„Ç¢„É°„É™„Ç´",
        "UK": "„Ç§„ÇÆ„É™„Çπ",
        "Russia": "„É≠„Ç∑„Ç¢",
        "Guardian": "„Ç¨„Éº„Éá„Ç£„Ç¢„É≥",
        "BBC": "Ëã±ÂõΩÊîæÈÄÅÂçî‰ºö",
        "says": "Ëø∞„Åπ„Å¶„ÅÑ„Åæ„Åô",
        "announces": "Áô∫Ë°®„Åó„Åæ„Åó„Åü",
        "reports": "Â†±ÈÅì„Åó„Å¶„ÅÑ„Åæ„Åô"
      };
      
      // Replace known words
      let result = text;
      Object.keys(mockTranslations).forEach(word => {
        const regex = new RegExp(word, 'gi');
        result = result.replace(regex, mockTranslations[word]);
      });
      
      return result !== text ? result + " (Á∞°ÊòìÁøªË®≥)" : "ÁøªË®≥‰∏çÂèØ";
    }

    function startRotation() {
      if (state.rotationTimer) clearInterval(state.rotationTimer);
      if (!state.isPaused) {
        state.rotationTimer = setInterval(showNextHeadline, config.rotationInterval);
      }
    }

    function showNextHeadline() {
      if (state.headlines.length === 0) return;
      
      state.currentIndex = (state.currentIndex + 1) % state.headlines.length;
      displayCurrentHeadline();
    }
    
    function showPrevHeadline() {
      if (state.headlines.length === 0) return;
      
      state.currentIndex = (state.currentIndex - 1 + state.headlines.length) % state.headlines.length;
      displayCurrentHeadline();
    }

    function togglePause() {
      state.isPaused = !state.isPaused;
      elements.pauseBtn.textContent = state.isPaused ? '‚ñ∂ Play' : '‚è∏ Pause';
      
      if (state.isPaused) {
        clearInterval(state.rotationTimer);
      } else {
        startRotation();
      }
    }

    // Translation functionality using MyMemory API
    async function translateText(text) {
      // Skip empty or very short text
      if (!text || text.length < 3) return 'ÁøªË®≥‰∏çÂèØ';
      
      // First check cache
      const cached = getCachedTranslation(text);
      if (cached) return cached;
      
      try {
        // Limit text length to avoid API errors
        const textToTranslate = text.length > 500 ? text.substring(0, 500) : text;
        
        const response = await fetch(`${config.translationAPI}?q=${encodeURIComponent(textToTranslate)}&langpair=en|ja`);
        
        if (!response.ok) {
          throw new Error(`API responded with ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.responseStatus !== 200 || !data.responseData) {
          throw new Error('Translation API error: ' + (data.responseDetails || 'Unknown error'));
        }
        
        return data.responseData.translatedText || 'ÁøªË®≥‰∏çÂèØ';
      } catch (error) {
        console.error('Translation API error:', error);
        // Fall back to simple translation
        return simpleTranslate(text);
      }
    }

    function cacheTranslation(original, translation) {
      if (!original || !translation) return;
      
      state.translationCache[original] = {
        translation: translation,
        expiry: Date.now() + config.translationCacheTTL
      };
      
      // Save to localStorage
      try {
        localStorage.setItem('translationCache', JSON.stringify(state.translationCache));
      } catch (e) {
        console.error('Failed to save translation cache', e);
      }
    }

    function getCachedTranslation(original) {
      if (!original) return null;
      
      const entry = state.translationCache[original];
      if (entry && entry.expiry > Date.now()) {
        return entry.translation;
      }
      return null;
    }

    // Article Modal functionality
    function openCurrentArticle() {
      if (state.headlines.length === 0) return;
      
      const headline = state.headlines[state.currentIndex];
      state.modalState.currentArticle = headline;
      state.modalState.currentSentenceIndex = 0;
      state.modalState.isOpen = true;
      
      // Extract sentences from content or description
      const content = headline.content || headline.description || headline.title;
      state.modalState.sentences = extractSentences(content);
      state.modalState.translations = Array(state.modalState.sentences.length).fill(null);
      
      elements.articleModal.classList.add('active');
      elements.closeModalBtn.focus();
      
      // Display the first sentence
      displayCurrentSentence();
    }

    function extractSentences(text) {
      // Simple sentence splitting that handles common cases
      if (!text) return [];
      
      // First clean any HTML tags
      const cleanText = text.replace(/<[^>]*>/g, ' ');
      
      // Split on sentence boundaries
      const sentences = cleanText.split(/(?<=[.!?])\s+/)
        .map(s => s.trim())
        .filter(s => s.length > 0);
      
      return sentences.length > 0 ? sentences : [cleanText];
    }

    function displayCurrentSentence() {
      if (!state.modalState.isOpen || !state.modalState.sentences) return;
      
      const currentIndex = state.modalState.currentSentenceIndex;
      const currentSentence = state.modalState.sentences[currentIndex];
      
      // Display the current sentence
      elements.articleSentence.textContent = currentSentence;
      
      // Update progress indicator
      elements.articleProgress.textContent = `Sentence ${currentIndex + 1} of ${state.modalState.sentences.length}`;
      
      // Check if we have a cached translation
      const cachedTranslation = getCachedTranslation(currentSentence);
      if (cachedTranslation) {
        elements.articleTranslation.textContent = cachedTranslation;
        state.modalState.translations[currentIndex] = cachedTranslation;
      } else {
        elements.articleTranslation.textContent = 'ÁøªË®≥‰∏≠...';
        // Fetch translation if we don't have it
        translateText(currentSentence)
          .then(translation => {
            state.modalState.translations[currentIndex] = translation;
            // Only update if we're still on the same sentence
            if (state.modalState.currentSentenceIndex === currentIndex) {
              elements.articleTranslation.textContent = translation;
            }
            cacheTranslation(currentSentence, translation);
          })
          .catch(error => {
            console.error('Sentence translation failed:', error);
            state.modalState.translations[currentIndex] = simpleTranslate(currentSentence);
            if (state.modalState.currentSentenceIndex === currentIndex) {
              elements.articleTranslation.textContent = state.modalState.translations[currentIndex];
            }
          });
      }
      
      updateSentenceNavigation();
    }

    function showNextSentence() {
      if (!state.modalState.sentences) return;
      
      const nextIndex = state.modalState.currentSentenceIndex + 1;
      if (nextIndex < state.modalState.sentences.length) {
        state.modalState.currentSentenceIndex = nextIndex;
        displayCurrentSentence();
      }
    }

    function showPrevSentence() {
      if (!state.modalState.sentences) return;
      
      const prevIndex = state.modalState.currentSentenceIndex - 1;
      if (prevIndex >= 0) {
        state.modalState.currentSentenceIndex = prevIndex;
        displayCurrentSentence();
      }
    }

    function updateSentenceNavigation() {
      if (!state.modalState.sentences) return;
      
      elements.prevSentenceBtn.disabled = state.modalState.currentSentenceIndex === 0;
      elements.nextSentenceBtn.disabled = state.modalState.currentSentenceIndex >= state.modalState.sentences.length - 1;
    }

    function closeModal() {
      state.modalState.isOpen = false;
      elements.articleModal.classList.remove('active');
    }

    // Clean up on page unload
    window.addEventListener('beforeunload', () => {
      clearInterval(state.clockTimer);
      clearInterval(state.rotationTimer);
      clearTimeout(state.weatherTimer);
    });

    // Initialize the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
